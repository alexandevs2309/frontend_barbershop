<!-- Configuraciones del Sistema - Plantilla completa optimizada -->
<div class="grid">
  <div class="col-12">
    <div class="card">
      <!-- Encabezado -->
      <div class="flex justify-content-between align-items-center mb-4">
        <h5 class="m-0 flex align-items-center gap-2">
          <i class="pi pi-cog"></i>
          <span>Configuraciones del Sistema</span>
        </h5>

        <div class="flex gap-2 flex-wrap">
          <button
            pButton
            type="button"
            label="Restablecer"
            icon="pi pi-refresh"
            class="p-button-outlined p-button-secondary p-button-sm"
            pTooltip="Restaurar valores por defecto"
            tooltipPosition="bottom"
            (click)="resetToDefaults()"
            [disabled]="loading || saving">
          </button>

          <button
            pButton
            type="button"
            label="Guardar"
            icon="pi pi-save"
            class="p-button-sm"
            (click)="saveSettings()"
            [loading]="saving"
            [disabled]="loading || settingsForm.invalid">
          </button>
        </div>
      </div>

      <!-- Loader -->
      <div *ngIf="loading" class="flex justify-content-center p-4">
        <p-progressSpinner></p-progressSpinner>
      </div>

      <!-- Formulario -->
      <form [formGroup]="settingsForm" *ngIf="!loading" (ngSubmit)="saveSettings()">
        <!-- Configuración General -->
        <div class="formgrid grid">
          <div class="field col-12 md:col-6">
            <label for="platform_name" class="block text-900 font-medium mb-2">
              Nombre de la Plataforma *
            </label>
            <input
              pInputText
              id="platform_name"
              formControlName="platform_name"
              placeholder="BarberSaaS"
              class="w-full"
              aria-label="Nombre de la plataforma"
              [attr.aria-describedby]="getFieldError('platform_name') ? 'err-platform_name' : null"
            />
            <small id="err-platform_name" class="p-error block mt-1" *ngIf="getFieldError('platform_name')">
              {{ getFieldError('platform_name') }}
            </small>
          </div>

          <div class="field col-12 md:col-6">
            <label for="support_email" class="block text-900 font-medium mb-2">
              Email de Soporte *
            </label>
            <input
              pInputText
              id="support_email"
              formControlName="support_email"
              placeholder="soporte@barbersaas.com"
              class="w-full"
              aria-label="Email de soporte"
              [attr.aria-describedby]="getFieldError('support_email') ? 'err-support_email' : null"
            />
            <small id="err-support_email" class="p-error block mt-1" *ngIf="getFieldError('support_email')">
              {{ getFieldError('support_email') }}
            </small>
          </div>
        </div>

        <p-divider></p-divider>

        <!-- Configuración de Tenants -->
        <h6 class="text-900 font-semibold mb-3">
          <i class="pi pi-building mr-2"></i>
          Configuración de Clientes
        </h6>

        <div class="formgrid grid">
          <div class="field col-12 md:col-4">
            <label for="max_tenants" class="block text-900 font-medium mb-2">
              Máximo de Clientes *
            </label>
            <p-inputNumber
              id="max_tenants"
              formControlName="max_tenants"
              [min]="1"
              [max]="10000"
              mode="decimal"
              showButtons="true"
              class="w-full"
              aria-label="Máximo de clientes">
            </p-inputNumber>
            <small class="p-error block mt-1" *ngIf="getFieldError('max_tenants')">
              {{ getFieldError('max_tenants') }}
            </small>
          </div>

          <div class="field col-12 md:col-4">
            <label for="trial_days" class="block text-900 font-medium mb-2">
              Días de Prueba *
            </label>
            <p-inputNumber
              id="trial_days"
              formControlName="trial_days"
              [min]="0"
              [max]="365"
              mode="decimal"
              suffix=" días"
              showButtons="true"
              class="w-full"
              aria-label="Días de prueba">
            </p-inputNumber>
            <small class="p-error block mt-1" *ngIf="getFieldError('trial_days')">
              {{ getFieldError('trial_days') }}
            </small>
          </div>

          <div class="field col-12 md:col-4">
            <label for="default_currency" class="block text-900 font-medium mb-2">
              Moneda por Defecto *
            </label>
            <p-dropdown
              id="default_currency"
              [options]="currencyOptions"
              formControlName="default_currency"
              optionLabel="label"
              optionValue="value"
              placeholder="Seleccionar moneda"
              class="w-full"
              aria-label="Moneda por defecto">
            </p-dropdown>
          </div>
        </div>

        <p-divider></p-divider>

        <!-- Configuración de Plataforma -->
        <h6 class="text-900 font-semibold mb-3">
          <i class="pi pi-globe mr-2"></i>
          Configuración de Plataforma
        </h6>

        <div class="formgrid grid">
          <div class="field col-12 md:col-4">
            <label for="platform_domain" class="block text-900 font-medium mb-2">
              Dominio Principal *
            </label>
            <input
              pInputText
              id="platform_domain"
              formControlName="platform_domain"
              placeholder="barbersaas.com"
              class="w-full"
              aria-label="Dominio principal"
              [attr.aria-describedby]="getFieldError('platform_domain') ? 'err-platform_domain' : null"
            />
            <small id="err-platform_domain" class="p-error block mt-1" *ngIf="getFieldError('platform_domain')">
              {{ getFieldError('platform_domain') }}
            </small>
          </div>

          <div class="field col-12 md:col-4">
            <label for="supported_languages" class="block text-900 font-medium mb-2">
              Idiomas Habilitados *
            </label>
            <p-multiSelect
              id="supported_languages"
              [options]="languageOptions"
              formControlName="supported_languages"
              optionLabel="label"
              optionValue="value"
              placeholder="Seleccionar idiomas"
              display="chip"
              class="w-full"
              aria-label="Idiomas habilitados">
            </p-multiSelect>
            <small class="text-500 block mt-1">Ej: Español, Inglés</small>
          </div>

          <div class="field col-12 md:col-4">
            <label for="platform_commission_rate" class="block text-900 font-medium mb-2">
              Comisión de Plataforma (%) *
            </label>
            <p-inputNumber
              id="platform_commission_rate"
              formControlName="platform_commission_rate"
              [min]="0"
              [max]="50"
              mode="decimal"
              suffix="%"
              showButtons="true"
              class="w-full"
              aria-label="Comisión de plataforma">
            </p-inputNumber>
            <small class="p-error block mt-1" *ngIf="getFieldError('platform_commission_rate')">
              {{ getFieldError('platform_commission_rate') }}
            </small>
          </div>
        </div>

        <p-divider></p-divider>

        <!-- Límites por Plan -->
        <h6 class="text-900 font-semibold mb-3">
          <i class="pi pi-tags mr-2"></i>
          Límites por Plan
        </h6>

        <div class="formgrid grid">
          <div class="field col-12 md:col-4">
            <label for="basic_plan_max_employees" class="block text-900 font-medium mb-2">
              Plan Básico - Máx. Empleados *
            </label>
            <p-inputNumber
              id="basic_plan_max_employees"
              formControlName="basic_plan_max_employees"
              [min]="1"
              [max]="100"
              mode="decimal"
              class="w-full"
              aria-label="Max empleados plan básico">
            </p-inputNumber>
          </div>

          <div class="field col-12 md:col-4">
            <label for="premium_plan_max_employees" class="block text-900 font-medium mb-2">
              Plan Premium - Máx. Empleados *
            </label>
            <p-inputNumber
              id="premium_plan_max_employees"
              formControlName="premium_plan_max_employees"
              [min]="1"
              [max]="500"
              mode="decimal"
              class="w-full"
              aria-label="Max empleados plan premium">
            </p-inputNumber>
          </div>

          <div class="field col-12 md:col-4">
            <label for="enterprise_plan_max_employees" class="block text-900 font-medium mb-2">
              Plan Enterprise - Máx. Empleados *
            </label>
            <p-inputNumber
              id="enterprise_plan_max_employees"
              formControlName="enterprise_plan_max_employees"
              [min]="1"
              [max]="9999"
              mode="decimal"
              class="w-full"
              aria-label="Max empleados plan enterprise">
            </p-inputNumber>
          </div>
        </div>

        <p-divider></p-divider>

        <!-- Integraciones Globales en panel colapsable -->
        <p-panel header="Integraciones Globales" [toggleable]="true" [collapsed]="false" class="mb-3">
          <div class="formgrid grid">
            <div class="field-checkbox col-12 md:col-4">
              <p-checkbox formControlName="stripe_enabled" [binary]="true" inputId="stripe"></p-checkbox>
              <label for="stripe" class="ml-2 text-900">Stripe Habilitado</label>
            </div>

            <div class="field-checkbox col-12 md:col-4">
              <p-checkbox formControlName="paypal_enabled" [binary]="true" inputId="paypal"></p-checkbox>
              <label for="paypal" class="ml-2 text-900">PayPal Habilitado</label>
            </div>

            <div class="field-checkbox col-12 md:col-4">
              <p-checkbox formControlName="twilio_enabled" [binary]="true" inputId="twilio"></p-checkbox>
              <label for="twilio" class="ml-2 text-900">SMS (Twilio) Habilitado</label>
            </div>

            <div class="field-checkbox col-12 md:col-4">
              <p-checkbox formControlName="sendgrid_enabled" [binary]="true" inputId="sendgrid"></p-checkbox>
              <label for="sendgrid" class="ml-2 text-900">Email (SendGrid) Habilitado</label>
            </div>

            <div class="field-checkbox col-12 md:col-4">
              <p-checkbox formControlName="aws_s3_enabled" [binary]="true" inputId="aws_s3"></p-checkbox>
              <label for="aws_s3" class="ml-2 text-900">Almacenamiento (AWS S3) Habilitado</label>
            </div>
          </div>
        </p-panel>

        <p-divider></p-divider>

        <!-- Preferencias del Sistema -->
        <h6 class="text-900 font-semibold mb-3">
          <i class="pi pi-sliders-h mr-2"></i>
          Preferencias del Sistema
        </h6>

        <div class="formgrid grid">
          <div class="field-checkbox col-12 md:col-4">
            <p-checkbox formControlName="maintenance_mode" [binary]="true" inputId="maintenance"></p-checkbox>
            <label for="maintenance" class="ml-2 text-900">Modo Mantenimiento</label>
          </div>

          <div class="field-checkbox col-12 md:col-4">
            <p-checkbox formControlName="email_notifications" [binary]="true" inputId="email_notifications"></p-checkbox>
            <label for="email_notifications" class="ml-2 text-900">Notificaciones por Email</label>
          </div>

          <div class="field-checkbox col-12 md:col-4">
            <p-checkbox formControlName="auto_suspend_expired" [binary]="true" inputId="auto_suspend"></p-checkbox>
            <label for="auto_suspend" class="ml-2 text-900">Suspender Automáticamente Vencidos</label>
          </div>
        </div>

        <!-- Espacio inferior para separación -->
        <div class="mt-4"></div>
      </form>
    </div>
  </div>
</div>

<!-- Confirm y Toast -->
<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>
