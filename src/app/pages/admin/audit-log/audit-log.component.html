   <div class="card">
  <h5 class="font-semibold">Auditoría del sistema</h5>

  <p-table
    #dt
    [value]="logs"
    [paginator]="true"
    [rows]="10"
    [loading]="loading"
    [globalFilterFields]="['user','action','model_name']"
    [rowsPerPageOptions]="[10,20,50]"
    [responsiveLayout]="'scroll'"
    [filterDelay]="300">

    <ng-template pTemplate="caption">
      <div class="flex justify-content-between align-items-center">
        <h6>Historial de cambios</h6>
        <span class="p-input-icon-left ml-5">
          
          <input pInputText type="text" (input)="onGlobalFilter($event)" placeholder="Buscar..."  />
        </span>
      </div>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="user">Usuario <p-sortIcon field="user"></p-sortIcon></th>
        <th pSortableColumn="action">Acción <p-sortIcon field="action"></p-sortIcon></th>
        <th pSortableColumn="source">Origen <p-sortIcon field="source"></p-sortIcon></th>
        <th>Modelo</th>
        <th>ID Objeto</th>
        <th pSortableColumn="timestamp">Fecha <p-sortIcon field="timestamp"></p-sortIcon></th>
        <th>Detalles</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-log>
      <tr>
        <td>{{ log.user?.email || 'Sistema' }}</td>
        <td><p-tag [value]="getActionLabel(log.action)" [severity]="getSeverity(log.action)"></p-tag></td>
        <td>{{ getSourceLabel(log.source) }}</td>
        <td>{{ log.content_type_name || '-' }}</td>
        <td>{{ log.object_id || '-' }}</td>
        <td>{{ log.timestamp | date:'short' }}</td>
        <td>
          <button pButton pRipple icon="pi pi-eye" label="Ver" class="p-button-text p-button-sm"
            (click)="showDetails(log)">
          </button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6">No se encontraron registros</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog
  header="Detalles del cambio"
  [(visible)]="displayDetails"
  [modal]="true"
  [style]="{width: '40vw'}"
  [dismissableMask]="true">
  <pre>{{ selectedLog?.changes | json }}</pre>
</p-dialog>
